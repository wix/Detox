<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="743px" preserveAspectRatio="none" style="width:842px;height:743px;background:#FFFFFF;" version="1.1" viewBox="0 0 842 743" width="842px" zoomAndPan="magnify"><defs/><g><rect fill="#FFFFFF" height="531.5898" style="stroke:#181818;stroke-width:1.0;" width="10" x="106.5" y="112.7988"/><rect fill="#FFFFFF" height="502.2793" style="stroke:#181818;stroke-width:1.0;" width="10" x="233.5" y="142.1094"/><rect fill="#FFFFFF" height="383.0371" style="stroke:#181818;stroke-width:1.0;" width="10" x="386.5" y="225.041"/><rect fill="#FFFFFF" height="353.7266" style="stroke:#181818;stroke-width:1.0;" width="10" x="526" y="254.3516"/><rect fill="#FFFFFF" height="175.8633" style="stroke:#181818;stroke-width:1.0;" width="10" x="719" y="366.5938"/><rect height="429.6582" style="stroke:#000000;stroke-width:1.5;fill:none;" width="771" x="65.5" y="186.4199"/><rect height="251.7949" style="stroke:#000000;stroke-width:1.5;fill:none;" width="679" x="147.5" y="327.9727"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="23" x2="23" y1="81.4883" y2="662.3887"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="111.5" x2="111.5" y1="81.4883" y2="662.3887"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="238.5" x2="238.5" y1="81.4883" y2="662.3887"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="391.5" x2="391.5" y1="81.4883" y2="662.3887"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="530.5" x2="530.5" y1="81.4883" y2="662.3887"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="723.5" x2="723.5" y1="81.4883" y2="662.3887"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="5" y="78.5352">User</text><ellipse cx="23.5" cy="13.5" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M23.5,21.5 L23.5,48.5 M10.5,29.5 L36.5,29.5 M23.5,48.5 L10.5,63.5 M23.5,48.5 L36.5,63.5 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="5" y="674.9238">User</text><ellipse cx="23.5" cy="686.377" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M23.5,694.377 L23.5,721.377 M10.5,702.377 L36.5,702.377 M23.5,721.377 L10.5,736.377 M23.5,721.377 L36.5,736.377 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="75.5" y="78.5352">Detox CLI</text><path d="M91,37 L91,61 M91,49 L108,49 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><ellipse cx="120" cy="49" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="75.5" y="674.9238">Detox CLI</text><path d="M91,681.877 L91,705.877 M91,693.877 L108,693.877 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><ellipse cx="120" cy="693.877" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="162" x="157.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="148" x="164.5" y="70.5352">DetoxPrimaryContext</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="162" x="157.5" y="661.3887"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="148" x="164.5" y="681.9238">DetoxPrimaryContext</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="72" x="352.5" y="78.5352">Jest (main)</text><path d="M371,37 L371,61 M371,49 L388,49 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><ellipse cx="400" cy="49" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="72" x="352.5" y="674.9238">Jest (main)</text><path d="M371,681.877 L371,705.877 M371,693.877 L388,693.877 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><ellipse cx="400" cy="693.877" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="181" x="440.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="167" x="447.5" y="70.5352">DetoxSecondaryContext</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="181" x="440.5" y="661.3887"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="167" x="447.5" y="681.9238">DetoxSecondaryContext</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="185" x="631.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="171" x="638.5" y="70.5352">DetoxCircusEnvironment</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="185" x="631.5" y="661.3887"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="171" x="638.5" y="681.9238">DetoxCircusEnvironment</text><rect fill="#FFFFFF" height="531.5898" style="stroke:#181818;stroke-width:1.0;" width="10" x="106.5" y="112.7988"/><rect fill="#FFFFFF" height="502.2793" style="stroke:#181818;stroke-width:1.0;" width="10" x="233.5" y="142.1094"/><rect fill="#FFFFFF" height="383.0371" style="stroke:#181818;stroke-width:1.0;" width="10" x="386.5" y="225.041"/><rect fill="#FFFFFF" height="353.7266" style="stroke:#181818;stroke-width:1.0;" width="10" x="526" y="254.3516"/><rect fill="#FFFFFF" height="175.8633" style="stroke:#181818;stroke-width:1.0;" width="10" x="719" y="366.5938"/><polygon fill="#181818" points="94.5,108.7988,104.5,112.7988,94.5,116.7988,98.5,112.7988" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="23.5" x2="100.5" y1="112.7988" y2="112.7988"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="64" x="30.5" y="108.0566">detox test</text><polygon fill="#181818" points="221.5,138.1094,231.5,142.1094,221.5,146.1094,225.5,142.1094" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="116.5" x2="227.5" y1="142.1094" y2="142.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94" x="123.5" y="137.3672">require('detox')</text><polygon fill="#181818" points="221.5,167.4199,231.5,171.4199,221.5,175.4199,225.5,171.4199" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="116.5" x2="227.5" y1="171.4199" y2="171.4199"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="29" x="123.5" y="166.6777">init()</text><path d="M65.5,186.4199 L139.5,186.4199 L139.5,193.7305 L129.5,203.7305 L65.5,203.7305 L65.5,186.4199 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="429.6582" style="stroke:#000000;stroke-width:1.5;" width="771" x="65.5" y="186.4199"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="80.5" y="199.9883">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="205" x="154.5" y="199.0547">[while exitCode != 0 and retries &gt; 0]</text><polygon fill="#181818" points="374.5,221.041,384.5,225.041,374.5,229.041,378.5,225.041" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="116.5" x2="380.5" y1="225.041" y2="225.041"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168" x="123.5" y="220.2988">child_process.spawn('jest')</text><polygon fill="#181818" points="514,250.3516,524,254.3516,514,258.3516,518,254.3516" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="396.5" x2="520" y1="254.3516" y2="254.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94" x="403.5" y="249.6094">require('detox')</text><polygon fill="#181818" points="514,279.6621,524,283.6621,514,287.6621,518,283.6621" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="396.5" x2="520" y1="283.6621" y2="283.6621"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="95" x="403.5" y="278.9199">resolveConfig()</text><polygon fill="#181818" points="514,308.9727,524,312.9727,514,316.9727,518,312.9727" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="396.5" x2="520" y1="312.9727" y2="312.9727"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="29" x="403.5" y="308.2305">init()</text><path d="M147.5,327.9727 L221.5,327.9727 L221.5,335.2832 L211.5,345.2832 L147.5,345.2832 L147.5,327.9727 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="251.7949" style="stroke:#000000;stroke-width:1.5;" width="679" x="147.5" y="327.9727"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="162.5" y="341.541">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="85" x="236.5" y="340.6074">[every test file]</text><polygon fill="#181818" points="707,362.5938,717,366.5938,707,370.5938,711,366.5938" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="396.5" x2="713" y1="366.5938" y2="366.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="33" x="403.5" y="361.8516">new()</text><polygon fill="#181818" points="707,391.9043,717,395.9043,707,399.9043,711,395.9043" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="396.5" x2="713" y1="395.9043" y2="395.9043"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43" x="403.5" y="391.1621">setup()</text><polygon fill="#181818" points="547,421.2148,537,425.2148,547,429.2148,543,425.2148" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="541" x2="718" y1="425.2148" y2="425.2148"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91" x="553" y="420.4727">installWorker()</text><polygon fill="#181818" points="254.5,450.5254,244.5,454.5254,254.5,458.5254,250.5,454.5254" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="248.5" x2="525" y1="454.5254" y2="454.5254"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="95" x="260.5" y="449.7832">register worker</text><polygon fill="#181818" points="707,479.8359,717,483.8359,707,487.8359,711,483.8359" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="396.5" x2="713" y1="483.8359" y2="483.8359"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="73" x="403.5" y="479.0938">run test file</text><polygon fill="#181818" points="707,509.1465,717,513.1465,707,517.1465,711,513.1465" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="396.5" x2="713" y1="513.1465" y2="513.1465"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="66" x="403.5" y="508.4043">teardown()</text><polygon fill="#181818" points="547,538.457,537,542.457,547,546.457,543,542.457" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="541" x2="723" y1="542.457" y2="542.457"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107" x="553" y="537.7148">uninstallWorker()</text><polygon fill="#181818" points="254.5,567.7676,244.5,571.7676,254.5,575.7676,250.5,571.7676" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="248.5" x2="385.5" y1="571.7676" y2="571.7676"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="260.5" y="567.0254">reportTestResults()</text><polygon fill="#181818" points="519,604.0781,529,608.0781,519,612.0781,523,608.0781" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="391.5" x2="525" y1="608.0781" y2="608.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="57" x="398.5" y="603.3359">cleanup()</text><polygon fill="#181818" points="226.5,640.3887,236.5,644.3887,226.5,648.3887,230.5,644.3887" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="111.5" x2="232.5" y1="644.3887" y2="644.3887"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="57" x="118.5" y="639.6465">cleanup()</text><!--MD5=[8544681171f572e3731090f3b4773b07]
@startuml

actor User
boundary "Detox CLI" as CLI
participant "DetoxPrimaryContext" as Pri
boundary "Jest (main)" as Jest0
participant "DetoxSecondaryContext" as Sec
participant "DetoxCircusEnvironment" as Env

User -> CLI: detox test
activate CLI
CLI -> Pri: require('detox')
activate Pri
CLI -> Pri: init()
loop while exitCode != 0 and retries > 0
  CLI -> Jest0: child_process.spawn('jest')
  activate Jest0
  Jest0 -> Sec: require('detox')
  activate Sec
  Jest0 -> Sec: resolveConfig()
  Jest0 -> Sec: init()
  loop every test file
    Jest0 -> Env: new()
    activate Env
    Jest0 -> Env: setup()
    Env -> Sec: installWorker()
    Sec - -> Pri: register worker
    Jest0 -> Env: run test file
    Jest0 -> Env: teardown()
    Env -> Sec: uninstallWorker()
    deactivate Env
    Jest0 - -> Pri: reportTestResults()
  end loop
  Jest0 -> Sec: cleanup()
  deactivate Sec
  deactivate Jest0
end loop
CLI -> Pri: cleanup()
deactivate Pri
deactivate CLI

@enduml

PlantUML version 1.2022.6(Tue Jun 21 20:34:49 EEST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: UA
--></g></svg>