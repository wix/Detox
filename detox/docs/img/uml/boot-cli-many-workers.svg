<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="831px" preserveAspectRatio="none" style="width:1190px;height:831px;background:#FFFFFF;" version="1.1" viewBox="0 0 1190 831" width="1190px" zoomAndPan="magnify"><defs/><g><rect fill="#FFFFFF" height="619.5215" style="stroke:#181818;stroke-width:1.0;" width="10" x="106.5" y="112.7988"/><rect fill="#FFFFFF" height="590.2109" style="stroke:#181818;stroke-width:1.0;" width="10" x="233.5" y="142.1094"/><rect fill="#FFFFFF" height="470.9688" style="stroke:#181818;stroke-width:1.0;" width="10" x="386.5" y="225.041"/><rect fill="#FFFFFF" height="441.6582" style="stroke:#181818;stroke-width:1.0;" width="10" x="532.5" y="254.3516"/><rect fill="#FFFFFF" height="332.416" style="stroke:#181818;stroke-width:1.0;" width="10" x="692.5" y="342.2832"/><rect fill="#FFFFFF" height="220.1738" style="stroke:#181818;stroke-width:1.0;" width="10" x="853" y="454.5254"/><rect fill="#FFFFFF" height="234.4844" style="stroke:#181818;stroke-width:1.0;" width="10" x="1060" y="395.9043"/><rect height="517.5898" style="stroke:#000000;stroke-width:1.5;fill:none;" width="1119" x="65.5" y="186.4199"/><rect height="310.416" style="stroke:#000000;stroke-width:1.5;fill:none;" width="1027" x="147.5" y="357.2832"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="23" x2="23" y1="81.4883" y2="750.3203"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="111.5" x2="111.5" y1="81.4883" y2="750.3203"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="238.5" x2="238.5" y1="81.4883" y2="750.3203"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="391.5" x2="391.5" y1="81.4883" y2="750.3203"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="537.5" x2="537.5" y1="81.4883" y2="750.3203"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="697.5" x2="697.5" y1="81.4883" y2="750.3203"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="857.5" x2="857.5" y1="81.4883" y2="750.3203"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1064.5" x2="1064.5" y1="81.4883" y2="750.3203"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="5" y="78.5352">User</text><ellipse cx="23.5" cy="13.5" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M23.5,21.5 L23.5,48.5 M10.5,29.5 L36.5,29.5 M23.5,48.5 L10.5,63.5 M23.5,48.5 L36.5,63.5 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="5" y="762.8555">User</text><ellipse cx="23.5" cy="774.3086" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M23.5,782.3086 L23.5,809.3086 M10.5,790.3086 L36.5,790.3086 M23.5,809.3086 L10.5,824.3086 M23.5,809.3086 L36.5,824.3086 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="75.5" y="78.5352">Detox CLI</text><path d="M91,37 L91,61 M91,49 L108,49 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><ellipse cx="120" cy="49" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="75.5" y="762.8555">Detox CLI</text><path d="M91,769.8086 L91,793.8086 M91,781.8086 L108,781.8086 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><ellipse cx="120" cy="781.8086" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="162" x="157.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="148" x="164.5" y="70.5352">DetoxPrimaryContext</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="162" x="157.5" y="749.3203"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="148" x="164.5" y="769.8555">DetoxPrimaryContext</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="72" x="352.5" y="78.5352">Jest (main)</text><path d="M371,37 L371,61 M371,49 L388,49 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><ellipse cx="400" cy="49" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="72" x="352.5" y="762.8555">Jest (main)</text><path d="M371,769.8086 L371,793.8086 M371,781.8086 L388,781.8086 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><ellipse cx="400" cy="781.8086" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="194" x="440.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="180" x="447.5" y="70.5352">DetoxSecondaryContext.0</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="194" x="440.5" y="749.3203"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="180" x="447.5" y="769.8555">DetoxSecondaryContext.0</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="100" x="644.5" y="78.5352">Jest (worker N)</text><path d="M677,37 L677,61 M677,49 L694,49 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><ellipse cx="706" cy="49" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="100" x="644.5" y="762.8555">Jest (worker N)</text><path d="M677,769.8086 L677,793.8086 M677,781.8086 L694,781.8086 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><ellipse cx="706" cy="781.8086" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="195" x="760.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="181" x="767.5" y="70.5352">DetoxSecondaryContext.N</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="195" x="760.5" y="749.3203"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="181" x="767.5" y="769.8555">DetoxSecondaryContext.N</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="199" x="965.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="185" x="972.5" y="70.5352">DetoxCircusEnvironment.N</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="199" x="965.5" y="749.3203"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="185" x="972.5" y="769.8555">DetoxCircusEnvironment.N</text><rect fill="#FFFFFF" height="619.5215" style="stroke:#181818;stroke-width:1.0;" width="10" x="106.5" y="112.7988"/><rect fill="#FFFFFF" height="590.2109" style="stroke:#181818;stroke-width:1.0;" width="10" x="233.5" y="142.1094"/><rect fill="#FFFFFF" height="470.9688" style="stroke:#181818;stroke-width:1.0;" width="10" x="386.5" y="225.041"/><rect fill="#FFFFFF" height="441.6582" style="stroke:#181818;stroke-width:1.0;" width="10" x="532.5" y="254.3516"/><rect fill="#FFFFFF" height="332.416" style="stroke:#181818;stroke-width:1.0;" width="10" x="692.5" y="342.2832"/><rect fill="#FFFFFF" height="220.1738" style="stroke:#181818;stroke-width:1.0;" width="10" x="853" y="454.5254"/><rect fill="#FFFFFF" height="234.4844" style="stroke:#181818;stroke-width:1.0;" width="10" x="1060" y="395.9043"/><polygon fill="#181818" points="94.5,108.7988,104.5,112.7988,94.5,116.7988,98.5,112.7988" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="23.5" x2="100.5" y1="112.7988" y2="112.7988"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="64" x="30.5" y="108.0566">detox test</text><polygon fill="#181818" points="221.5,138.1094,231.5,142.1094,221.5,146.1094,225.5,142.1094" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="116.5" x2="227.5" y1="142.1094" y2="142.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94" x="123.5" y="137.3672">require('detox')</text><polygon fill="#181818" points="221.5,167.4199,231.5,171.4199,221.5,175.4199,225.5,171.4199" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="116.5" x2="227.5" y1="171.4199" y2="171.4199"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="29" x="123.5" y="166.6777">init()</text><path d="M65.5,186.4199 L139.5,186.4199 L139.5,193.7305 L129.5,203.7305 L65.5,203.7305 L65.5,186.4199 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="517.5898" style="stroke:#000000;stroke-width:1.5;" width="1119" x="65.5" y="186.4199"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="80.5" y="199.9883">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="205" x="154.5" y="199.0547">[while exitCode != 0 and retries &gt; 0]</text><polygon fill="#181818" points="374.5,221.041,384.5,225.041,374.5,229.041,378.5,225.041" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="116.5" x2="380.5" y1="225.041" y2="225.041"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168" x="123.5" y="220.2988">child_process.spawn('jest')</text><polygon fill="#181818" points="520.5,250.3516,530.5,254.3516,520.5,258.3516,524.5,254.3516" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="396.5" x2="526.5" y1="254.3516" y2="254.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94" x="403.5" y="249.6094">require('detox')</text><polygon fill="#181818" points="520.5,279.6621,530.5,283.6621,520.5,287.6621,524.5,283.6621" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="396.5" x2="526.5" y1="283.6621" y2="283.6621"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="95" x="403.5" y="278.9199">resolveConfig()</text><polygon fill="#181818" points="520.5,308.9727,530.5,312.9727,520.5,316.9727,524.5,312.9727" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="396.5" x2="526.5" y1="312.9727" y2="312.9727"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="29" x="403.5" y="308.2305">init()</text><polygon fill="#181818" points="680.5,338.2832,690.5,342.2832,680.5,346.2832,684.5,342.2832" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="396.5" x2="686.5" y1="342.2832" y2="342.2832"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125" x="403.5" y="337.541">child_process.fork()</text><path d="M147.5,357.2832 L221.5,357.2832 L221.5,364.5938 L211.5,374.5938 L147.5,374.5938 L147.5,357.2832 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="310.416" style="stroke:#000000;stroke-width:1.5;" width="1027" x="147.5" y="357.2832"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="162.5" y="370.8516">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="85" x="236.5" y="369.918">[every test file]</text><polygon fill="#181818" points="1048,391.9043,1058,395.9043,1048,399.9043,1052,395.9043" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="702.5" x2="1054" y1="395.9043" y2="395.9043"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="33" x="709.5" y="391.1621">new()</text><polygon fill="#181818" points="1048,421.2148,1058,425.2148,1048,429.2148,1052,425.2148" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="702.5" x2="1054" y1="425.2148" y2="425.2148"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43" x="709.5" y="420.4727">setup()</text><polygon fill="#181818" points="874,450.5254,864,454.5254,874,458.5254,870,454.5254" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="868" x2="1059" y1="454.5254" y2="454.5254"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94" x="880" y="449.7832">require('detox')</text><polygon fill="#181818" points="874,479.8359,864,483.8359,874,487.8359,870,483.8359" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="868" x2="1059" y1="483.8359" y2="483.8359"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="29" x="880" y="479.0938">init()</text><polygon fill="#181818" points="874,509.1465,864,513.1465,874,517.1465,870,513.1465" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="868" x2="1059" y1="513.1465" y2="513.1465"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91" x="880" y="508.4043">installWorker()</text><polygon fill="#181818" points="254.5,538.457,244.5,542.457,254.5,546.457,250.5,542.457" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="248.5" x2="852" y1="542.457" y2="542.457"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="95" x="260.5" y="537.7148">register worker</text><polygon fill="#181818" points="1048,567.7676,1058,571.7676,1048,575.7676,1052,571.7676" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="702.5" x2="1054" y1="571.7676" y2="571.7676"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="73" x="709.5" y="567.0254">run test file</text><polygon fill="#181818" points="1048,597.0781,1058,601.0781,1048,605.0781,1052,601.0781" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="702.5" x2="1054" y1="601.0781" y2="601.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="66" x="709.5" y="596.3359">teardown()</text><polygon fill="#181818" points="874,626.3887,864,630.3887,874,634.3887,870,630.3887" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="868" x2="1064" y1="630.3887" y2="630.3887"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107" x="880" y="625.6465">uninstallWorker()</text><polygon fill="#181818" points="254.5,655.6992,244.5,659.6992,254.5,663.6992,250.5,659.6992" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="248.5" x2="385.5" y1="659.6992" y2="659.6992"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="260.5" y="654.957">reportTestResults()</text><polygon fill="#181818" points="525.5,692.0098,535.5,696.0098,525.5,700.0098,529.5,696.0098" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="391.5" x2="531.5" y1="696.0098" y2="696.0098"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="57" x="398.5" y="691.2676">cleanup()</text><polygon fill="#181818" points="226.5,728.3203,236.5,732.3203,226.5,736.3203,230.5,732.3203" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="111.5" x2="232.5" y1="732.3203" y2="732.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="57" x="118.5" y="727.5781">cleanup()</text><!--MD5=[8b1c69ac2ddc4ae699c51a4769131172]
@startuml

actor User
boundary "Detox CLI" as CLI
participant "DetoxPrimaryContext" as Pri
boundary "Jest (main)" as Jest0
participant "DetoxSecondaryContext.0" as Sec0
boundary "Jest (worker N)" as JestN
participant "DetoxSecondaryContext.N" as SecN
participant "DetoxCircusEnvironment.N" as Env

User -> CLI: detox test
activate CLI
CLI -> Pri: require('detox')
activate Pri
CLI -> Pri: init()
loop while exitCode != 0 and retries > 0
  CLI -> Jest0: child_process.spawn('jest')
  activate Jest0
  Jest0 -> Sec0: require('detox')
  activate Sec0
  Jest0 -> Sec0: resolveConfig()
  Jest0 -> Sec0: init()
  Jest0 -> JestN: child_process.fork()
  activate JestN
  loop every test file
    JestN -> Env: new()
    activate Env
    JestN -> Env: setup()
    Env -> SecN: require('detox')
    activate SecN
    Env -> SecN: init()
    Env -> SecN: installWorker()
    SecN - -> Pri: register worker
    JestN -> Env: run test file
    JestN -> Env: teardown()
    Env -> SecN: uninstallWorker()
    deactivate Env
    Jest0 - -> Pri: reportTestResults()
  end loop
  deactivate SecN
  deactivate JestN
  Jest0 -> Sec0: cleanup()
  deactivate Sec0
  deactivate Jest0
end loop
CLI -> Pri: cleanup()
deactivate Pri
deactivate CLI

@enduml

PlantUML version 1.2022.6(Tue Jun 21 20:34:49 EEST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: UA
--></g></svg>