"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[4034],{4922:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>s,contentTitle:()=>l,default:()=>u,frontMatter:()=>r,metadata:()=>a,toc:()=>d});var t=i(58168),o=(i(96540),i(15680));const r={id:"building-the-app",slug:"troubleshooting/building-the-app",title:"Dealing With Problems With Building the App & Detox",sidebar_label:"Dealing With Problems With Building the App & Detox"},l=void 0,a={unversionedId:"building-the-app",id:"version-19.x/building-the-app",title:"Dealing With Problems With Building the App & Detox",description:"Dealing With Problems With Building the App & Detox",source:"@site/versioned_docs/version-19.x/Troubleshooting.BuildingTheApp.md",sourceDirName:".",slug:"/troubleshooting/building-the-app",permalink:"/Detox/docs/19.x/troubleshooting/building-the-app",draft:!1,editUrl:"https://github.com/wix/Detox/edit/master/docs/versioned_docs/version-19.x/Troubleshooting.BuildingTheApp.md",tags:[],version:"19.x",frontMatter:{id:"building-the-app",slug:"troubleshooting/building-the-app",title:"Dealing With Problems With Building the App & Detox",sidebar_label:"Dealing With Problems With Building the App & Detox"},sidebar:"tutorialSidebar",previous:{title:"Troubleshooting",permalink:"/Detox/docs/19.x/troubleshooting/troubleshooting"},next:{title:"Dealing With Problems With Running Tests",permalink:"/Detox/docs/19.x/troubleshooting/running-tests"}},s={},d=[{value:"Dealing With Problems With Building the App &amp; Detox",id:"dealing-with-problems-with-building-the-app--detox",level:2},{value:"Android",id:"android",level:2},{value:"Problem: AAPT - resource linking failure",id:"problem-aapt---resource-linking-failure",level:3},{value:"Problem: minSdkVersion mismatch",id:"problem-minsdkversion-mismatch",level:3},{value:"Problem: Kotlin <code>stdlib</code> version conflicts",id:"problem-kotlin-stdlib-version-conflicts",level:3},{value:"Resolving for a precompiled dependency (<code>.aar</code>)",id:"resolving-for-a-precompiled-dependency-aar",level:4},{value:"Resolving for a compiling subproject",id:"resolving-for-a-compiling-subproject",level:4},{value:"Problem: <code>Duplicate files copied in ...</code>",id:"problem-duplicate-files-copied-in-",level:3}],p={toc:d},c="wrapper";function u({components:e,...n}){return(0,o.yg)(c,(0,t.A)({},p,n,{components:e,mdxType:"MDXLayout"}),(0,o.yg)("h2",{id:"dealing-with-problems-with-building-the-app--detox"},"Dealing With Problems With Building the App & Detox"),(0,o.yg)("p",null,"This page is about issues related to building the app, typically triggered when running ",(0,o.yg)("inlineCode",{parentName:"p"},"detox build")," (and not ",(0,o.yg)("inlineCode",{parentName:"p"},"detox test"),", for example)."),(0,o.yg)("p",null,"For troubleshooting of other issue, refer to our ",(0,o.yg)("a",{parentName:"p",href:"/Detox/docs/19.x/troubleshooting/troubleshooting"},"troubleshooting index"),"."),(0,o.yg)("h2",{id:"android"},"Android"),(0,o.yg)("h3",{id:"problem-aapt---resource-linking-failure"},"Problem: AAPT - resource linking failure"),(0,o.yg)("p",null,"For build errors involving AAPT resource linking failure, such as this one:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-text"},"Execution failed for task ':app:processReleaseAndroidTestResources'.\n> A failure occurred while executing com.android.build.gradle.internal.res.LinkApplicationAndroidResourcesTask$TaskAction\n   > Android resource linking failed\n     ERROR:: AAPT: error: resource style/Widget.AppCompat.TextView ...\n")),(0,o.yg)("p",null,"Ensure that the following line appears in your app's ",(0,o.yg)("inlineCode",{parentName:"p"},"buildscript")," (",(0,o.yg)("inlineCode",{parentName:"p"},"android/app/build.gradle"),") in the ",(0,o.yg)("inlineCode",{parentName:"p"},"dependencies")," section:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-groovy"},"dependencies {\n    // ...\n    implementation 'androidx.appcompat:appcompat:1.1.0' // (check what the latest version is!)\n}\n")),(0,o.yg)("h3",{id:"problem-minsdkversion-mismatch"},"Problem: minSdkVersion mismatch"),(0,o.yg)("p",null,"For Gradle errors involving ",(0,o.yg)("inlineCode",{parentName:"p"},"minSdkVersion")," mismatches resembling this one:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-text"},'uses-sdk:minSdkVersion 18 cannot be smaller than version 21 declared in library [com.facebook.react:react-native:0.64.3] /Users/janedoe/.gradle/caches/transforms-3/6a9cd4eeeb285f80b9e6f413ecd78d0d/transformed/jetified-react-native-0.64.3/AndroidManifest.xml as the library might be using APIs not available in 18\n        Suggestion: use a compatible library with a minSdk of at most 18,\n                or increase this project\'s minSdk version to at least 21,\n                or use tools:overrideLibrary="com.facebook.react" to force usage (may lead to runtime failures)\n')),(0,o.yg)("p",null,"Try applying the solution suggested in ",(0,o.yg)("a",{parentName:"p",href:"https://stackoverflow.com/questions/21032271/how-to-inject-android-configuration-to-each-subproject-with-gradle"},"this Stack-overflow")," post, namely adding this to your root-project's ",(0,o.yg)("inlineCode",{parentName:"p"},"build.gradle")," file (replace ",(0,o.yg)("inlineCode",{parentName:"p"},"21")," those matching your app's ",(0,o.yg)("inlineCode",{parentName:"p"},"build.gradle"),"):"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-groovy"},"// build.gradle\n\nallprojects {\n    afterEvaluate {\n        if (it.hasProperty('android')){\n            android {\n                defaultConfig {\n                    minSdkVersion 21 // Replace '21' with whatever suites your case\n                }\n            }\n        }\n    }\n}\n")),(0,o.yg)("h3",{id:"problem-kotlin-stdlib-version-conflicts"},"Problem: Kotlin ",(0,o.yg)("inlineCode",{parentName:"h3"},"stdlib")," version conflicts"),(0,o.yg)("p",null,"The problems and resolutions here are different depending on whether you\u2019re using Detox as a precompiled dependency artifact (i.e. an ",(0,o.yg)("inlineCode",{parentName:"p"},".aar"),") - which is by far the common case, or compiling it yourself."),(0,o.yg)("h4",{id:"resolving-for-a-precompiled-dependency-aar"},"Resolving for a precompiled dependency (",(0,o.yg)("inlineCode",{parentName:"h4"},".aar"),")"),(0,o.yg)("p",null,"Of all ",(0,o.yg)("a",{parentName:"p",href:"https://kotlinlang.org/docs/reference/using-gradle.html#configuring-dependencies"},"Kotlin implementation flavors"),", Detox assumes the most recent one, namely ",(0,o.yg)("inlineCode",{parentName:"p"},"kotlin-stdlib-jdk8"),'. If your Android build fails due to conflicts with implementations coming from other dependencies or even your own app, consider adding an exclusion to either the "other" dependencies or detox itself, for example:'),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-diff"},"dependencies {\n-    androidTestImplementation('com.wix:detox:+')\n+    androidTestImplementation('com.wix:detox:+') { \n+        exclude group: 'org.jetbrains.kotlin', module: 'kotlin-stdlib-jdk8'\n+    }\n}\n")),(0,o.yg)("p",null,"Detox should work with ",(0,o.yg)("inlineCode",{parentName:"p"},"kotlin-stdlib-jdk7"),", as well."),(0,o.yg)("p",null,"A typical error output formed by ",(0,o.yg)("inlineCode",{parentName:"p"},"Gradle")," in this case is as provided, for example, in ",(0,o.yg)("a",{parentName:"p",href:"https://github.com/wix/Detox/issues/1380"},"#1380"),":"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-text"},"Could not determine the dependencies of task ':detox:compileDebugAidl'.\n> Could not resolve all task dependencies for configuration ':detox:debugCompileClasspath'.\n   > Could not resolve org.jetbrains.kotlin:kotlin-stdlib:1.3.0.\n     Required by:\n         project :detox\n      > Cannot find a version of 'org.jetbrains.kotlin:kotlin-stdlib' that satisfies the version constraints:\n           Dependency path 'OurApp:detox:unspecified' --\x3e 'com.squareup.okhttp3:okhttp:4.0.0-alpha01' --\x3e 'org.jetbrains.kotlin:kotlin-stdlib:1.3.30'\n           Dependency path 'OurApp:detox:unspecified' --\x3e 'com.squareup.okio:okio:2.2.2' --\x3e 'org.jetbrains.kotlin:kotlin-stdlib:1.2.60'\n           Dependency path 'OurApp:detox:unspecified' --\x3e 'org.jetbrains.kotlin:kotlin-stdlib-jdk8:1.3.0' --\x3e 'org.jetbrains.kotlin:kotlin-stdlib:1.3.0'\n           Dependency path 'OurApp:detox:unspecified' --\x3e 'com.facebook.react:react-native:0.59.5' --\x3e 'com.squareup.okhttp3:okhttp:4.0.0-alpha01' --\x3e 'org.jetbrains.kotlin:kotlin-stdlib:1.3.30'\n           Dependency path 'OurApp:detox:unspecified' --\x3e 'com.facebook.react:react-native:0.59.5' --\x3e 'com.squareup.okio:okio:2.2.2' --\x3e 'org.jetbrains.kotlin:kotlin-stdlib:1.2.60'\n           Dependency path 'OurApp:detox:unspecified' --\x3e 'org.jetbrains.kotlin:kotlin-stdlib-jdk8:1.3.0' --\x3e 'org.jetbrains.kotlin:kotlin-stdlib-jdk7:1.3.0' --\x3e 'org.jetbrains.kotlin:kotlin-stdlib:1.3.0'\n           Constraint path 'OurApp:detox:unspecified' --\x3e 'org.jetbrains.kotlin:kotlin-stdlib' strictly '1.3.0' because of the following reason: debugRuntimeClasspath uses version 1.3.0\n           Constraint path 'OurApp:detox:unspecified' --\x3e 'org.jetbrains.kotlin:kotlin-stdlib' strictly '1.3.0' because of the following reason: debugRuntimeClasspath uses version 1.3.0\n\n   > Could not resolve org.jetbrains.kotlin:kotlin-stdlib-common:1.3.0.\n     Required by:\n         project :detox\n      > Cannot find a version of 'org.jetbrains.kotlin:kotlin-stdlib-common' that satisfies the version constraints:\n           Dependency path 'OurApp:detox:unspecified' --\x3e 'com.squareup.okhttp3:okhttp:4.0.0-alpha01' --\x3e 'org.jetbrains.kotlin:kotlin-stdlib:1.3.30' --\x3e 'org.jetbrains.kotlin:kotlin-stdlib-common:1.3.30'\n           Constraint path 'OurApp:detox:unspecified' --\x3e 'org.jetbrains.kotlin:kotlin-stdlib-common' strictly '1.3.0' because of the following reason: debugRuntimeClasspath uses version 1.3.0\n")),(0,o.yg)("p",null,"(i.e. the project indirectly depends on different versions of ",(0,o.yg)("inlineCode",{parentName:"p"},"kotlin-stdlib"),", such as ",(0,o.yg)("inlineCode",{parentName:"p"},"1.3.0"),", ",(0,o.yg)("inlineCode",{parentName:"p"},"1.3.30"),", ",(0,o.yg)("inlineCode",{parentName:"p"},"1.2.60"),")"),(0,o.yg)("h4",{id:"resolving-for-a-compiling-subproject"},"Resolving for a compiling subproject"),(0,o.yg)("p",null,"Detox requires the Kotlin standard-library as its own dependency. Due to the ",(0,o.yg)("a",{parentName:"p",href:"https://kotlinlang.org/docs/reference/using-gradle.html#configuring-dependencies"},"many flavors")," by which Kotlin has been released, multiple dependencies often create a conflict."),(0,o.yg)("p",null,"For that, Detox allows for the exact specification of the standard library to use using two Gradle globals: ",(0,o.yg)("inlineCode",{parentName:"p"},"detoxKotlinVersion")," and ",(0,o.yg)("inlineCode",{parentName:"p"},"detoxKotlinStdlib"),". You can define both in your  root build-script file (i.e.",(0,o.yg)("inlineCode",{parentName:"p"},"android/build.gradle"),"):"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-groovy"},"buildscript {\n    // ...\n    ext.detoxKotlinVersion = '1.3.0' // Detox' default is 1.2.0\n    ext.detoxKotlinStdlib = 'kotlin-stdlib-jdk7' // Detox' default is kotlin-stdlib-jdk8\n}\n")),(0,o.yg)("h3",{id:"problem-duplicate-files-copied-in-"},"Problem: ",(0,o.yg)("inlineCode",{parentName:"h3"},"Duplicate files copied in ...")),(0,o.yg)("p",null,"If you get an error like this:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-text"},"Execution failed for task ':app:transformResourcesWithMergeJavaResForDebug'.\n> com.android.build.api.transform.TransformException: com.android.builder.packaging.DuplicateFileException: Duplicate files copied in APK META-INF/LICENSE\n")),(0,o.yg)("p",null,"You need to add this to the ",(0,o.yg)("inlineCode",{parentName:"p"},"android")," section of your ",(0,o.yg)("inlineCode",{parentName:"p"},"android/app/build.gradle"),":"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-groovy"},"packagingOptions {\n    exclude 'META-INF/LICENSE'\n}\n")))}u.isMDXComponent=!0},15680:(e,n,i)=>{i.d(n,{xA:()=>p,yg:()=>m});var t=i(96540);function o(e,n,i){return n in e?Object.defineProperty(e,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[n]=i,e}function r(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,t)}return i}function l(e){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?r(Object(i),!0).forEach(function(n){o(e,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):r(Object(i)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))})}return e}function a(e,n){if(null==e)return{};var i,t,o=function(e,n){if(null==e)return{};var i,t,o={},r=Object.keys(e);for(t=0;t<r.length;t++)i=r[t],n.indexOf(i)>=0||(o[i]=e[i]);return o}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(t=0;t<r.length;t++)i=r[t],n.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(o[i]=e[i])}return o}var s=t.createContext({}),d=function(e){var n=t.useContext(s),i=n;return e&&(i="function"==typeof e?e(n):l(l({},n),e)),i},p=function(e){var n=d(e.components);return t.createElement(s.Provider,{value:n},e.children)},c="mdxType",u={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},g=t.forwardRef(function(e,n){var i=e.components,o=e.mdxType,r=e.originalType,s=e.parentName,p=a(e,["components","mdxType","originalType","parentName"]),c=d(i),g=o,m=c["".concat(s,".").concat(g)]||c[g]||u[g]||r;return i?t.createElement(m,l(l({ref:n},p),{},{components:i})):t.createElement(m,l({ref:n},p))});function m(e,n){var i=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var r=i.length,l=new Array(r);l[0]=g;var a={};for(var s in n)hasOwnProperty.call(n,s)&&(a[s]=n[s]);a.originalType=e,a[c]="string"==typeof e?e:o,l[1]=a;for(var d=2;d<r;d++)l[d]=i[d];return t.createElement.apply(null,l)}return t.createElement.apply(null,i)}g.displayName="MDXCreateElement"}}]);