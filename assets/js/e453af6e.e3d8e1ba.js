"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[6646],{15680:(e,t,n)=>{n.d(t,{xA:()=>c,yg:()=>m});var a=n(96540);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach(function(t){o(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function s(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var p=a.createContext({}),l=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=l(e.components);return a.createElement(p.Provider,{value:t},e.children)},d="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef(function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,p=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),d=l(n),u=o,m=d["".concat(p,".").concat(u)]||d[u]||h[u]||r;return n?a.createElement(m,i(i({ref:t},c),{},{components:n})):a.createElement(m,i({ref:t},c))});function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=u;var s={};for(var p in t)hasOwnProperty.call(t,p)&&(s[p]=t[p]);s.originalType=e,s[d]="string"==typeof e?e:o,i[1]=s;for(var l=2;l<r;l++)i[l]=n[l];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},77274:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>i,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>l});var a=n(58168),o=(n(96540),n(15680));const r={},i="How Detox Works",s={unversionedId:"articles/how-detox-works",id:"version-20.x/articles/how-detox-works",title:"How Detox Works",description:"Detox is an end-to-end testing framework. This means it runs your app on an actual device, or a device simulator/emulator and interacts with it just like a real user would. This type of testing can give a lot of confidence in your app and help automate an otherwise tedious manual QA process.",source:"@site/versioned_docs/version-20.x/articles/how-detox-works.md",sourceDirName:"articles",slug:"/articles/how-detox-works",permalink:"/Detox/docs/articles/how-detox-works",draft:!1,editUrl:"https://github.com/wix/Detox/edit/master/docs/versioned_docs/version-20.x/articles/how-detox-works.md",tags:[],version:"20.x",frontMatter:{},sidebar:"apiSidebar",previous:{title:"Design Principles",permalink:"/Detox/docs/articles/design-principles"},next:{title:"Third-Party Drivers",permalink:"/Detox/docs/articles/third-party-drivers"}},p={},l=[{value:"Automatic App-State Synchronization",id:"automatic-app-state-synchronization",level:2},{value:"Operations Detox synchronizes with automatically",id:"operations-detox-synchronizes-with-automatically",level:3},{value:"Architecture",id:"architecture",level:2}],c={toc:l},d="wrapper";function h({components:e,...t}){return(0,o.yg)(d,(0,a.A)({},c,t,{components:e,mdxType:"MDXLayout"}),(0,o.yg)("h1",{id:"how-detox-works"},"How Detox Works"),(0,o.yg)("p",null,"Detox is an end-to-end testing framework. This means it runs your app on an actual device, or a device simulator/emulator and interacts with it just like a real user would. This type of testing can give a lot of confidence in your app and help automate an otherwise tedious manual QA process."),(0,o.yg)("p",null,"When a Detox test executes, you actually have two different parts running side by side:"),(0,o.yg)("ol",null,(0,o.yg)("li",{parentName:"ol"},(0,o.yg)("p",{parentName:"li"},(0,o.yg)("strong",{parentName:"p"},"The mobile app itself"),", running on a device or a device simulator/emulator. A regular native-build of your app is installed and executed on the device, orchestrated by native Detox code that is built separately and installed alongside the app itself.")),(0,o.yg)("li",{parentName:"ol"},(0,o.yg)("p",{parentName:"li"},(0,o.yg)("strong",{parentName:"p"},"The test suite"),", running on Node.js, over a test runner like Jest. The tests are normally written in JavaScript, and utilize the JavaScript part of Detox."))),(0,o.yg)("p",null,"The two parts are run in separate processes on your machine. It is also possible to run the two parts on different machines. Communication between the two parts takes place over the network using a web socket."),(0,o.yg)("p",null,"In practice, to make the communication more resilient, both parts are implemented as clients and communicate through a Detox server that acts as mediator. Having that server allows for some advantages like allowing one side to disconnect (during a simulator boot for example or app restart) without disconnecting the other side and losing its state."),(0,o.yg)("h2",{id:"automatic-app-state-synchronization"},"Automatic App-State Synchronization"),(0,o.yg)("p",null,"One of Detox's key features is the automatic synchronization of test execution with the app's state. For example, consider the following super-common moment in a test scenario:"),(0,o.yg)("ol",null,(0,o.yg)("li",{parentName:"ol"},"Node.js runs test code that effectively tells Detox to tap on the ",(0,o.yg)("em",{parentName:"li"},"login")," button. Detox sends this tap command to the app."),(0,o.yg)("li",{parentName:"ol"},"The app receives the command, the button is pressed, and the login process begins. A secure user session is obtained from the server, and the app navigates to the home screen. The home screen fetches yet even more data from the servers and renders elements with loading animations."),(0,o.yg)("li",{parentName:"ol"},(0,o.yg)("strong",{parentName:"li"},"Detox - being a gray-box testing framework, monitors these changes in the app's state and waits for them to complete. This ensures that the test and the app's current state remain in-sync.")),(0,o.yg)("li",{parentName:"ol"},"Detox proceeds to the next action in the test code only after the app is stable (!)")),(0,o.yg)("p",null,"Let\u2019s deep-dive into step #2: So much UI work happens with numerous network requests performed in the background\u2026 What is the order of execution of those requests, and how long should you wait until all of them are replied to? How long should you wait until the UI is ready? For the network, it depends on which request completes first, which in turn depends on network congestion and how busy the server is. As for the UI, it depends on the specific test device / machine specs and how busy its processor is."),(0,o.yg)("p",null,"In the traditional black-box (rather than gray-box) testing approach, you normally deal with being blind to the app\u2019s state by adding various ",(0,o.yg)("inlineCode",{parentName:"p"},"sleep()")," / ",(0,o.yg)("inlineCode",{parentName:"p"},"waitFor()")," commands throughout the test in an attempt to force order into the chaos. In step #3, ",(0,o.yg)("strong",{parentName:"p"},"Detox eliminates the need for that malpractice, and so introduces stability into the otherwise inherently-flaky test world.")),(0,o.yg)("h3",{id:"operations-detox-synchronizes-with-automatically"},"Operations Detox synchronizes with automatically"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("p",{parentName:"li"},(0,o.yg)("strong",{parentName:"p"},"Network requests")," - Detox monitors in-flight requests over the network (waiting for them to be responded).")),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("p",{parentName:"li"},(0,o.yg)("strong",{parentName:"p"},"Main thread (native)")," - Detox monitors pending native operations on the app's main thread (main dispatch queue and main ",(0,o.yg)("inlineCode",{parentName:"p"},"NSOperationQueue"),").")),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("p",{parentName:"li"},(0,o.yg)("strong",{parentName:"p"},"Layout of UI")," - Detox monitors UI layout operations. There\u2019s also special support for React Native layout which includes the Shadow Queue where ",(0,o.yg)("a",{parentName:"p",href:"https://github.com/facebook/yoga"},"yoga")," runs.")),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("p",{parentName:"li"},(0,o.yg)("strong",{parentName:"p"},"Timers")," - Detox monitors timers (explicit asynchronous delays). There\u2019s special support for JavaScript's ",(0,o.yg)("inlineCode",{parentName:"p"},"setTimeout"),", which is monitored.")),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("p",{parentName:"li"},(0,o.yg)("strong",{parentName:"p"},"Animations")," - Detox monitors active animations and transitions. There\u2019s special support for React Native animations with the Animated library, and even the popular ",(0,o.yg)("a",{parentName:"p",href:"https://docs.swmansion.com/react-native-reanimated"},"react-native-reanimated"),".")),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("p",{parentName:"li"},(0,o.yg)("strong",{parentName:"p"},"React Native JavaScript thread")," - Detox monitors pending operations on the JavaScript thread in RN apps.")),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("p",{parentName:"li"},(0,o.yg)("strong",{parentName:"p"},"React Native native-modules thread")," - Detox monitors pending RN native-module actions executed on its dedicated thread.")),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("p",{parentName:"li"},(0,o.yg)("strong",{parentName:"p"},"React Native bridge")," - In non-bridge-less apps (i.e. before RN's new-architecture), Detox monitors the React Native bridge and asynchronous messages delivered through it."))),(0,o.yg)("admonition",{type:"info"},(0,o.yg)("p",{parentName:"admonition"},"In this synchronization process, ",(0,o.yg)("a",{parentName:"p",href:"/Detox/docs/config/session#sessiondebugsynchronization-number"},(0,o.yg)("inlineCode",{parentName:"a"},"session.debugSynchronization"))," plays a significant role. This setting, enabled by default, keeps an eye on tasks that are keeping the app busy and logs the details if these actions take longer than the specified value to complete.")),(0,o.yg)("h2",{id:"architecture"},"Architecture"),(0,o.yg)("p",null,"Detox comprises the following components:"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("a",{parentName:"li",href:"https://github.com/wix/Detox/tree/master/detox/src"},(0,o.yg)("strong",{parentName:"a"},"Tester")),": The testing component, running in a Node.js process on the host computer, executing the test logic. The tester is also responsible for device management and artifact collection."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("strong",{parentName:"li"},"Detox native client (",(0,o.yg)("a",{parentName:"strong",href:"https://github.com/wix/Detox/tree/master/detox/ios"},"iOS")," & ",(0,o.yg)("a",{parentName:"strong",href:"https://github.com/wix/Detox/tree/master/detox/android"},"Android"),"):")," A component that gets seamlessly integrated into the tested app on the tested device, right as Detox starts executing. It synchronizes with the app, matches user queries, executes user commands (e.g. taps, scrolls) and validates expectations."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("strong",{parentName:"li"},(0,o.yg)("a",{parentName:"strong",href:"https://github.com/wix/Detox/tree/master/detox/src/server"},"Detox mediator server")),": A small web socket server, running in a Node.js process on the host computer, used to connect between the tester and the client. Normally, the tester starts a server on a randomized session id and an available port, and sends the session and port to the client app as a launch argument.")))}h.isMDXComponent=!0}}]);